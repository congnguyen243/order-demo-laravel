(window._sbz_4_jsonp_17765a9205e=window._sbz_4_jsonp_17765a9205e||[]).push([[70],{260:function(e,t,r){"use strict";r.r(t);var i=r(0);const n=r(17).getParser(window.navigator.userAgent).parsedResult;function a(e,t){let r=i.a.get(e,"conditions")||[],a=t.matchAccountSetting()||{},o=t.matchSession()||{},s=new Date,c=s.getMinutes()+60*s.getHours();if(function(e,t){let r=t.matchLastBotRun(e.id);if(!r)return!0;if(i.a.get(e,"initiative_frequency.once_per_user"))return!1;let n=t.matchSession()||{};if(i.a.get(e,"initiative_frequency.once_per_session")&&r.session_id===n.id)return!1;if(i.a.get(e,"initiative_frequency.interval_sec")){if(i.a.get(e,"initiative_frequency.interval_sec")>(Date.now()-r.created)/1e3)return!1}return!0}(e,t)){for(let e of r)switch(e.key){case"url":if(i.a.size(e.exclude_urls)>0){if(i.a.find(e.exclude_urls,e=>i.a.norm(window.location.href).indexOf(i.a.norm(e))>-1))return!1}if(i.a.size(e.urls)>0){if(!i.a.find(e.urls,e=>i.a.norm(window.location.href).indexOf(i.a.norm(e))>-1))return!1}break;case"browser":if(i.a.size(e.browsers)>0){let t=i.a.get(n,"browser.name");if(!i.a.find(e.browsers,e=>i.a.norm(e)===i.a.norm(t)))return!1}break;case"location":if(i.a.size(e.exclude_locations)>0){if(i.a.find(e.exclude_locations,e=>!(!e.city_name||!e.country_code||e.city_name!==o.city_name||e.country_code!==o.country_code)||(!(!e.city_name||e.country_code||e.city_name!==o.city_name)||(!(e.city_name||!e.country_code||e.country_code!==o.country_code)||void 0))))return!1}if(i.a.size(e.locations)>0){if(!i.a.find(e.locations,e=>!(!e.city_name||!e.country_code||e.city_name!==o.city_name||e.country_code!==o.country_code)||(!(!e.city_name||e.country_code||e.city_name!==o.city_name)||(!(e.city_name||!e.country_code||e.country_code!==o.country_code)||void 0))))return!1}break;case"returning_visitor":if(e.returning_visitor&&t.new_visitor)return!1;if(!e.returning_visitor&&!t.new_visitor)return!1;break;case"user_is_a_contact":let r=i.a.get(t.matchUser(),"attributes",[]),s=i.a.find(r,e=>"emails"===e.key),_=i.a.find(r,e=>"phones"===e.key),f=s||_;if(e.user_is_a_contact&&!f)return!1;if(!e.user_is_a_contact&&f)return!1;break;case"device_type":if(i.a.size(e.device_types)>0){let t=i.a.get(n,"platform.type");if(!i.a.find(e.device_types,e=>i.a.norm(e)===i.a.norm(t)))return!1}break;case"referer":if(i.a.size(e.exclude_referers)>0){if(i.a.find(e.exclude_referers,e=>i.a.norm(document.referrer).indexOf(i.a.norm(e))>-1))return!1}if(i.a.size(e.urls)>0){if(!i.a.find(e.referers,e=>i.a.norm(document.referrer).indexOf(i.a.norm(e))>-1))return!1}break;case"source":if(i.a.size(e.sources)>0&&!i.a.find(e.sources,e=>i.a.norm(e)===i.a.norm(o.source)))return!1;break;case"user_attribute":let d;i.a.each(user.attributes,e=>{e&&e.key===key&&(value=e.datetime||e.boolean||e.number||e.text||e.list)});let l=!0;switch(e.operator){case"cons":let t=i.a.parseJSON(e.value)||[];if(0===i.a.size(t))return!1;l=!!i.a.find(t,e=>i.a.norm(d).indexOf(i.a.norm(e))>-1);break;case"notEmpty":l=""!=d;break;case"empty":l=""==d;break;case"true":l=!0===d||"true"===d;break;case"false":l=!d||!1===d||"false"===d}if(!l)return!1;break;case"timming":if("in"===e.business_hour&&!a.is_in_business_hour)return!1;if("notIn"===e.business_hour&&a.is_in_business_hour)return!1;if(i.a.size(e.days_of_week)>0){if(!i.a.find(e.days_of_week,e=>i.a.getDayName((new Date).getDay())===i.a.norm(e)))return!1}if(i.a.size(e.minute_of_days)>0&&i.a.size(e.minute_of_days)%2==0){let t=!1;for(var u=0;u<e.minute_of_days.length;u+=2)if(e.minute_of_days[u]<=c&&c<=e.minute_of_days[u+1]){t=!0;break}if(!t)return!1}break;case"offline":if(!a.is_online!==!!e.offline)return!1}return!0}}function o(e,t,r){let n=!1;async function o(r){if(n)return;if(n=!0,!a(e,t))return;console.log("[SBZ] BOT RUN BY",r);let{error:i}=await t.startConvo({state:"active",members:[{type:"bot",id:e.id}]});if(i)return console.error(i);t.logBotRun(e.id)}this.init=()=>{let t=i.a.get(e,"triggers")||[];for(let e of t){if(!e)continue;if(e.disabled)continue;let t=o.bind(this,e.type);"area_clicked"===e.type&&i.a.trackAreaClicked(e.area_clicked_css_selector,t),"scrolling_percentage"===e.type&&i.a.trackScrollingPercentage(e.scrolling_percentage,t),"inactivity_duration"===e.type&&i.a.trackInactivity(e.inactivity_sec,t),"after_pageview"===e.type&&i.a.trackTimeOnPage(e.after_pageview_sec,t)}}}t.default=class{constructor(e){let t=e.store.matchBot();0!==Object.keys(t).length&&i.a.each(t,t=>new o(t,e.store,e).init())}}}}]);